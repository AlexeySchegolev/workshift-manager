# Server-Client-Architektur Integration

Diese Anleitung beschreibt die vollst√§ndige Integration der neuen Server-Client-Architektur f√ºr die Schichtplanung-Anwendung.

## üèóÔ∏è Architektur-√úbersicht

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CLIENT (React + TypeScript)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ Components  ‚îÇ  ‚îÇ   Pages     ‚îÇ  ‚îÇ   Hooks     ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ ApiService  ‚îÇ  ‚îÇ State Mgmt  ‚îÇ  ‚îÇ UI Services ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                         HTTP/REST API
                              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 SERVER (Node.js + Express + TypeScript)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ API Routes  ‚îÇ  ‚îÇ Middleware  ‚îÇ  ‚îÇ Validation  ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ  ‚îÇ Services    ‚îÇ  ‚îÇ Database    ‚îÇ  ‚îÇ Logging     ‚îÇ         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                         SQLite Database
                              ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DATABASE (SQLite)                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  employees | locations | shift_plans | shift_rules          ‚îÇ
‚îÇ  shift_assignments | constraint_violations | audit_log      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üöÄ Setup & Installation

### 1. Backend-Server Setup

```bash
# 1. In das Server-Verzeichnis wechseln
cd server

# 2. Dependencies installieren
npm install

# 3. Umgebungsvariablen konfigurieren
cp .env.example .env
# .env nach Bedarf anpassen

# 4. TypeScript kompilieren
npm run build

# 5. Datenbank initialisieren
npm run migrate
npm run seed

# 6. Server starten
npm run dev  # Development
# oder
npm start    # Production
```

### 2. Frontend-Integration

```bash
# 1. Umgebungsvariablen f√ºr Frontend
cp .env.example .env
# REACT_APP_API_URL=http://localhost:3001/api

# 2. Frontend starten (separates Terminal)
npm start
```

## üìä Datenmigration

### Automatische Migration

Die bestehenden Daten werden automatisch beim ersten Server-Start migriert:

1. **Mitarbeiterdaten** aus `src/data/employeeData.ts`
2. **Standortdaten** aus `src/data/locationData.ts`
3. **Schichtregeln** aus `src/data/defaultRules.ts`

### Manuelle Migration

Falls eine manuelle Migration erforderlich ist:

```bash
cd server
node dist/database/seed.js --clear  # Alte Daten l√∂schen
node dist/database/seed.js          # Neue Daten einf√ºgen
```

## üîå API-Integration

### Frontend-Service-Anpassung

Der neue [`ApiService`](src/services/ApiService.ts) ersetzt die lokalen Services:

```typescript
// Vorher (localStorage)
import { PersistenceService } from './PersistenceService';
const employees = PersistenceService.loadEmployees();

// Nachher (API)
import { ApiService } from './ApiService';
const response = await ApiService.getEmployees();
const employees = response.data;
```

### Beispiel-Integration in Komponenten

```typescript
import React, { useState, useEffect } from 'react';
import { ApiService } from '../services/ApiService';
import { Employee } from '../models/interfaces';

const EmployeeList: React.FC = () => {
  const [employees, setEmployees] = useState<Employee[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const loadEmployees = async () => {
      try {
        setLoading(true);
        const response = await ApiService.getEmployees();
        setEmployees(response.data);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Fehler beim Laden');
      } finally {
        setLoading(false);
      }
    };

    loadEmployees();
  }, []);

  if (loading) return <div>L√§dt...</div>;
  if (error) return <div>Fehler: {error}</div>;

  return (
    <div>
      {employees.map(emp => (
        <div key={emp.id}>{emp.name} - {emp.role}</div>
      ))}
    </div>
  );
};
```

## üîÑ Schichtplanung-Integration

### Neue Schichtplan-Generierung

```typescript
import { ApiService } from '../services/ApiService';

const generatePlan = async (year: number, month: number) => {
  try {
    const result = await ApiService.generateShiftPlan({
      year,
      month,
      useRelaxedRules: false
    });
    
    console.log('Schichtplan generiert:', result);
    // result.shiftPlan - Der generierte Plan
    // result.violations - Regelverletzungen
    // result.statistics - Planungsstatistiken
    
  } catch (error) {
    console.error('Fehler bei Schichtplan-Generierung:', error);
  }
};
```

### Bestehende Komponenten anpassen

Die wichtigsten Komponenten m√ºssen angepasst werden:

1. **ShiftPlanningPage.tsx** - API-Calls statt lokale Services
2. **EmployeePage.tsx** - CRUD-Operationen √ºber API
3. **LocationManagementPage.tsx** - Standort-Management √ºber API
4. **ShiftTable.tsx** - Daten von API laden

## üîß Entwicklung & Testing

### Parallele Entwicklung

```bash
# Terminal 1: Backend-Server
cd server
npm run dev

# Terminal 2: Frontend-Server  
npm start

# Terminal 3: API-Tests
curl http://localhost:3001/api/employees
```

### Health Checks

```bash
# Server-Status pr√ºfen
curl http://localhost:3001/health

# API-Endpunkte testen
curl http://localhost:3001/api
curl http://localhost:3001/api/employees/stats
```

## üõ†Ô∏è Konfiguration

### Backend-Konfiguration (`server/.env`)

```env
NODE_ENV=development
PORT=3001
DATABASE_PATH=./data/schichtplanung.db
ALLOWED_ORIGINS=http://localhost:3000
RATE_LIMIT_MAX_REQUESTS=1000
LOG_LEVEL=debug
```

### Frontend-Konfiguration (`.env`)

```env
REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_ENV=development
REACT_APP_ENABLE_API=true
REACT_APP_DEBUG=true
```

## üîí Sicherheit

### CORS-Konfiguration

Der Server ist f√ºr lokale Entwicklung konfiguriert:

```typescript
// server/src/server.ts
cors({
  origin: ['http://localhost:3000', 'http://127.0.0.1:3000'],
  credentials: true
})
```

### Rate Limiting

API-Calls sind limitiert:
- Development: 1000 Requests/15min
- Production: 100 Requests/15min

## üìà Performance

### Caching-Strategie

1. **Browser-Cache** - HTTP-Headers f√ºr statische Daten
2. **Memory-Cache** - H√§ufig abgerufene Daten im Server
3. **Database-Indizes** - Optimierte Datenbankabfragen

### Optimierungen

```typescript
// Paginierung f√ºr gro√üe Datens√§tze
const employees = await ApiService.getEmployees({
  page: 1,
  limit: 20,
  role: 'Pfleger'
});

// Lazy Loading f√ºr Schichtpl√§ne
const plan = await ApiService.getShiftPlan(2024, 1);
```

## üêõ Troubleshooting

### H√§ufige Probleme

1. **CORS-Fehler**
   ```
   L√∂sung: ALLOWED_ORIGINS in server/.env pr√ºfen
   ```

2. **API nicht erreichbar**
   ```bash
   # Server-Status pr√ºfen
   curl http://localhost:3001/health
   
   # Port-Konflikte pr√ºfen
   lsof -ti:3001
   ```

3. **Datenbank-Fehler**
   ```bash
   # Datenbank zur√ºcksetzen
   cd server
   rm -f data/*.db
   npm run migrate
   npm run seed
   ```

4. **TypeScript-Fehler**
   ```bash
   # Backend kompilieren
   cd server
   npm run build
   
   # Frontend neu starten
   npm start
   ```

### Debug-Modus

```bash
# Backend mit Debug-Logs
cd server
DEBUG=* npm run dev

# Frontend mit API-Debug
REACT_APP_DEBUG=true npm start
```

## üöÄ Deployment

### Production-Setup

```bash
# 1. Backend bauen
cd server
npm run build

# 2. Frontend bauen
npm run build

# 3. Server starten
cd server
NODE_ENV=production npm start
```

### Docker-Deployment

```dockerfile
# server/Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY dist/ ./dist/
EXPOSE 3001
CMD ["npm", "start"]
```

## üìã Checkliste

### Vor dem Go-Live

- [ ] Backend-Server l√§uft stabil
- [ ] Datenbank ist migriert
- [ ] API-Endpunkte funktionieren
- [ ] Frontend kann mit API kommunizieren
- [ ] Schichtplanung funktioniert √ºber API
- [ ] Error-Handling implementiert
- [ ] Logging konfiguriert
- [ ] Performance getestet
- [ ] Security-Headers gesetzt
- [ ] Backup-Strategie definiert

### Nach dem Go-Live

- [ ] Monitoring eingerichtet
- [ ] Log-Rotation konfiguriert
- [ ] Backup-Jobs laufen
- [ ] Performance-Metriken √ºberwachen
- [ ] User-Feedback sammeln

## üìû Support

Bei Problemen oder Fragen:

1. **Logs pr√ºfen**: `server/logs/` oder `pm2 logs`
2. **Health Check**: `curl http://localhost:3001/health`
3. **API-Status**: `curl http://localhost:3001/api`
4. **Datenbank-Status**: SQLite-Browser verwenden

---

**Hinweis**: Diese Architektur ist vollst√§ndig r√ºckw√§rtskompatibel. Das Frontend kann weiterhin mit localStorage arbeiten, wenn der Server nicht verf√ºgbar ist.